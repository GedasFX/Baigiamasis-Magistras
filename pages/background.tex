\section{Background}

% #### Literature review

% Most of the contextual questions can be answered from literature review. Due to the practical nature of the research, 

% ##### eIDAS

\subsection{eID}

In Estonia, digital identity has been around for over 20 years \cite{eelaw-idcard}. The Estonian government has loaded all identity cards issued with certificates enabling cardholders to identify themselves digitally. Compare the speed of adoption to Romania, where the first easy access to eIDs came in the form of new chip ID cards in August of 2021 \cite{romania-adopts-eid}.

Estonia's early adoption of eID, the political focus on digital government, has led to over 89\% of internet users accessing the e-government, landing it the first place in the EU \cite{eu-desi}. The 20 years of easy access to an eID has led to a stark difference to Romania, where only 16\% of internet users access the government services online.

Depending on the country a company would like to access the market, eID sign-in may confuse the potential clients. Early adopters must be aware of the widespread adoption of the eID infrastructure.

In different countries, the eID solution may vary wildly. There can also be more than one eID solution in a singular county.


\subsection{eIDAS}

The eIDAS regulation \cite{eulaw-eidas} provided the groundwork for recognizing the signatures issued by other EU countries by imposing strict liability and mutual-recognition requirements. The regulation introduced the concept of a Trust Service Provider (TSP), which allowed relying parties to have a trust anchor. Each member state maintains a list of TSPs, where each TSP is certified to perform specific tasks, such as timestamping or issuing signing certificates. The regulation also requires member states to establish eID systems, if they haven't already, and make them able to be integrated into a federal system.

The regulation was the basis for creating the eIDAS node network \cite{carretero2018federated}. These nodes connect across country borders, allowing users to authenticate with the eID of their home (eID issuer) country in the host (current residence) country. The eIDAS authentication protocol redirects the authentication requests to the appropriate country, federating the identification process. For the institutions trying to target the EU market, this provides a significant advantage since access to one node would mean access to all nodes in the EU.

The main issue private companies will encounter is the highly restricted access to any nodes. The eIDAS network is only concerned about connecting countries. To allow access to the web would be up for the member state to decide.

\subsection{eID widespread adoption}

\subsubsection{eID adoption in Estonia and Lithuania}

On the surface, Estonia and Lithuania have the exact eID solutions - Bank Link, ID card, Mobile-ID, and Smart-ID. However, even with the same infrastructure, we see many inconsistencies even in the case of just these two countries.

Consider Lithuania. It is possible to connect from a centralized website \url{https://epaslaugos.lt} to access the public sector services \cite{eidasnode-lt}. Here it is possible to sign in via bank link, ID card, and Mobile-ID. Smart-ID is not part of the list. Although most banks support sign-in via three major eID providers, including Smart-ID, some listed banks like PaySera provide significant security concerns. With that bank, it is possible to access the e-government services with only email, password, and a 2FA code sent to the registered person's phone number \todo{source: I did it myself 02-27}. For this reason, Estonia's Information System Authority has taken steps to deprecate bank link \cite{ria-deprecates-bank-link} from use in TARA. In Estonia, all three major authentication options, ID card, Mobile-ID, and Smart-ID, are available to access the e-government.

\subsubsection{eIDAS notifications in Estonia and Lithuania}

For countries to communicate through the eIDAS node network, countries must notify the European Commission about what eID authentication methods they could provide \cite{eulaw-eidas}. Other countries can then use these methods to authenticate foreign citizens into their public services.

In the case of Estonia, the country has notified the European Commission about its Smart card and Mobile-ID authentication methods \cite{eulaw-eidas-notified}. Smart-ID is not a permitted method of authentication in the context of eIDAS. In Lithuania's case, only the Smart card solution is allowed - no mobile sign-in methods have been notified \cite{eulaw-eidas-notified}.

Estonia and Lithuania have shown a gap between what countries consider to be a secure and trusted source of eID and what they are willing to be held liable for in the context of eIDAS.

\subsection{eID providers in Estonia}

Applied Cyber Security Group of the University of Tartu maintains a list of e-services \cite{ut-eidinestonia} that uses at least one eID authentication method in Estonia. The following authentication methods were listed: Bank Link, ID-card, Mobile-ID, Smart-ID, TARA, and HarID.

\subsubsection{Bank link}

Banks have initially created this authentication method to provide close integration with e-commerce providers to receive risk-free payments \cite{kerem2003internet}. Over time it saw an additional use case - secure and trustworthy authentication method for the public and private services \cite{sebbanklink}. Over time researchers found that the protocol used was extremely insecure \cite{banklinksecurityanalysis}. From March of 2021, RIA has disabled the use of bank link to access public services \cite{ria-deprecates-bank-link}, which accounted for only 1 percent of all authentications.

Due to the lack of security auditing required to satisfy eIDAS, poor market reach, and no support from the government, this authentication method will not be discussed in the scope of this thesis.

\subsubsection{ID-card}

Id cards are the most popular way to access their eID in Estonia, primarily due to the legal requirement of having one. Chapter 2 of the Identity Documents Act \cite{eelaw-idcard} requires all EU, not only Estonian, citizens residing in Estonia to hold an ID card, with which they could access public services online. Interestingly, this requirement caused the government to issue more ID cards than there are people in Estonia \cite{ria-idee,statee-population}.

There are no variable costs to allow a person to log in to websites with their ID card. For this authentication method, no per-transaction fees exist, as the certificate validity service (OCSP) \cite{rfc6960} can be queried for free.

An end user's computer can extract an authentication certificate from their ID card with the help of special software distributed by the government \cite{ria-idee}. This certificate, once on the computer, can be sent to the private company's authorization server with Client Certificate TLS option \cite{rfc8446} natively or with the use of specialized helper library \cite{ria-webeid}, using standard REST calls.

Qualified trust service provider for Qualified Certificates for e-signatures \todo{Why does this matter?} installs the certificates in ID-cards \cite{eu-trustservices}, which ensures a high degree of certainty about the identity of person authenticating.

A significant advantage of using a decentralized eID infrastructure, such as the ID-card authentication, is that there are no middlemen in the process, allowing companies to skip going into expensive contracts with an eID service provider.

\subsubsection{Mobile-ID}

Five years after SK ID Solutions introduced ID cards for use in Estonia, they have developed a mobile phone-friendly way to access the users' eID for use in Estonia and Lithuania \cite{sk-history2007}. SK achieved it by extending the functionality of SIM cards to make them mimic the functionality of ID cards.

The price of using Mobile-ID for the service provider varies based on usage, starting from 10 euro per month (10ct per request) to costing over 5 000 euro, where the effective cost is under 1ct for request \cite{sk-mobileidpricing}. For the end-user, mobile operators can charge an additional fee for the use of this service \cite{telia-mobileid}.

Accepting Mobile-ID would allow companies to access the markets of two countries: Estonia, and Lithuania, as the technical implementation is identical.

Qualified trust service provider for Qualified Certificates for e-signatures installs the certificates in a particular variety of SIM cards, capable of supporting Mobile-ID \cite{eu-trustservices}, which ensures a high degree of certainty about the identity of person authenticating.

\TODO{Explain why companies should not consider this protocol in the protocol choice section.}

\subsubsection{Smart-ID}

Smart-ID is the latest and fastest-growing way of accessing citizens' eID, working in all 3 of the Baltic States \cite{sk-history2017}. The protocol utilizes mobile phones as authentication, similar to Mobile-ID. Unlike Mobile-ID, it does not require specialized external hardware \cite{smartid-docs}. The authentication process is handled by combining the eID server and the end user's smartphone. Despite that, it still passed the eIDAS compliance audit for the requirement of ensuring signature private key is "with a high level of confidence under sole control" of its owner \cite{enisa-eidasreq}. After passing the audit, Smart-ID was recognized as a QSCD, allowing it to create QES in 2018 \cite{smartid-qscd}.

The price of using Smart-ID for service providers, much like Mobile-ID, varies based on usage, starting from 50 euros per month (10ct per request) to over 20 000 euros, where the effective cost is under 1ct for request, based on the total amount of transactions performed within a month \cite{sk-smartidpricing}. For users, unlike Mobile-ID \cite{telia-mobileid}, there are no telecommunication operators involved, and there are no costs associated with using Smart-ID.

Implementation of Smart-ID would allow users to access the markets of three countries: Estonia, Latvia, and Lithuania.

Qualified trust service provider for Qualified Certificates for e-signatures users their data centers to hold part of the private key and certificate used to authenticate users \cite{eu-trustservices}, which ensures a high degree of certainty about the identity of person authenticating.

\subsubsection{TARA}

TARA is Estonia's primary gateway for authentication to public services \cite{tara}. TARA provides the ability for users to sign in with any of the three primary eID methods of Estonia and with the eID schemes of other EU member states. The ability to authenticate with the systems of other countries is of particular interest, as it also doubles up as the official eIDAS node of Estonia \cite{tara}.

Estonian Information System Authority intends to limit the use of TARA to public services only \cite{tara-business}.

Technical implementation for the consumer, unlike Mobile-ID and Smart-ID, will be much easier to implement, as it uses the well-adopted protocol of OpenID Connect \cite{tara-technical, oidc}.

It is worth mentioning while the underlying authentication methods have received proper eIDAS auditing and are backed by a qualified trust service, this and all of the following authentication methods have not been audited in compliance with eIDAS.

Unlike the eID providers backed by a Trust Service Provider, TARA acts as only an authentication service. It would not be able to provide means of signing documents \cite{tara-technical}. If the business is considering expanding to allow for online digital signing, an infrastructure like TARA will unlikely be a great choice.

\subsubsection{eeID}

Estonian Internet Foundation created eeID service for the exclusive purpose of bringing eID authentication to the private sector \cite{eeid}. It is a clone of TARA without it being Estonia's gateway for the eIDAS node network. The similarities mean that all points outlined to TARA apply to this service too.

The service is new, does not have pricing tiers, and currently asks for 9ct per successful authentication request \cite{eeid-pricing}.

The vision of the said service is to allow users to access the markets of all EU countries. Currently, there are only fourteen countries with notified eID authentication methods \cite{eulaw-eidas-notified}: Estonia, Germany, Italy, Spain, Belgium, Luxembourg, Croatia, Portugal, Latvia, Lithuania, Netherlands, Czech Republic, Slovakia, and Denmark.\todo{Does it work? Have to wait as much as I can}

\subsubsection{HarID}

Estonian Ministry of Education and Research created this service for the youth of Estonia to access different educational institutions across Estonia \cite{harid}. ID cards are only legally required to be held by citizens over the age of 15 \cite{eelaw-idcard}, so everyone under would have been unable to access their school system. HarID accepts TARA authentication methods with the addition of username \& password. This authentication method is held exclusively for the education sector and will be skipped over in this thesis.

\subsubsection{Dokobit}

In the initial list of services using eID in Estonia \cite{ut-eidinestonia}, one service stands out - Dokobit \cite{dokobit}. They provide services comparable to eeID in that they aggregate different eID methods of Estonia (ID-card, Mobile-ID, and Smart-ID) and other countries. The primary difference between the authentication providers is the multi-national implementation goal - Dokobit relies on integrating each country's system individually. In contrast, eeID depends on using the framework of the eIDAS infrastructure \cite{eeid}.

Pricing for Dokobit varies drastically, and the provided prices for the Baltic States \cite{dokobit-pricing} start at 50 euros per month (7.1ct per request), going down to 4.2ct per request at 500 euros per month.

Dokobit supports 11 countries: Estonia, Italy, Spain, Belgium, Latvia, Lithuania, Finland, Norway, Iceland, Poland, and Portugal \cite{dokobit}.

UAB Dokobit is a trust service provider for Qualified validation of qualified e-signature. It means the service itself does not provide Digital Signature certificates, but eIDAS considers the results of validation of signatures trustworthy \cite{eu-trustservices}.

\subsection{Authentication and eID and QSCD}

\TODO{Maybe find a better spot for this section}
\TODO{Fact check?}

The requirements for Estonian ID cards make a clear distinction between "ADF AWP" and "ADF QSCD" applications. Both software applications are loaded onto the smart card; however, only the QSCD application, guarded by PIN2, can create QES. Implication here is that for authentication with an ID card, a QSCD is not used.

Fundamentally, the only legal guarantees provided by eIDAS require the use of QSCD \cite{eulaw-eidas}, and for authentication this process, this device is not used \cite{ee-id-tech}. It is up to the relying party to trust the authentication certificate and signature associated with the authentication challenge. This technicality affects business in only the document signing part of the business - using encryption or authentication certificates does not provide the necessary legal guarantees.

Similarly, when using a third-party provider such as TARA (eeID) or Dokobit, the new eID provider acts as a new trust anchor. Companies must consider the risks of using such providers, as adding any middleware increases the attack surface on the company.

\subsection{Levels of assurance}
\TODO{Levels of assurance section}


\subsection{GDPR}

When dealing with eID, sensitive personal data processing is required.
\TODO{GDPR section}

\subsection{Federated Identity Architecture of the European eID System}\todo{Does this belong in related work? This paper is de-facto required background}

The authors of this paper describe the current situation in the identity management landscape \cite{federated-europe-identity}. The researchers provide all the necessary background information to understand the implementation details of any eID authentication system design.

\subsubsection{Authentication methods}

The first significant contribution relates to explaining different ways of authenticating persons.

Any authentication method is based on something user knows (password, pin code, answer to security question), is (biometrics - eyes, fingerprints), or has (physical device - key card, USB device) \cite{o2003comparing}. Any other method would leave the person without agency over the authentication process.

An emphasis is put on the importance of mixing and matching these authentication schemes to increase the system's security.

\subsubsection{Authentication Paradigms and Models}

The second helpful point of the paper is the description of different identity management paradigms and models \cite{identity-paradigms}. Paradigms refer to the implementation and deployment, whereas models refer to the data storage and roles.

The three main paradigms as network, service, or user-centric. The network-centric approach gathers all identities into one place, usually known as a "Domain Controller." The service-centric method would create a new identity for each service, leading to high duplication. The user-centric paradigm makes the user prove their own identity. Europe's eID solution does not favor any of the paradigms allowing identity providers to innovate \cite{eelaw-idcard,eeid,dokobit}.

There are also three authentication models: isolated, centralized, and federated. Unlike paradigms, where any of them is fair game, Europe's identity providers can use only the federated one. The isolated model requires all services to hold a copy of every identity in the EU. The centralized model is suitable for having a central place for looking up identity in a country, and it is an excellent solution for high-profile agencies. The federated system has the advantage of scaling well horizontally and not requiring to keep an index of all citizens it would like to serve, which is a tremendous advantage in the world of GDPR.

\subsubsection{Authentication protocols and services}

Researchers have allocated a good portion of the paper to provide an overview of potential protocols and implementations. The list is massive and in-depth; however, it becomes clear that SAML \cite{saml}, OAuth2.0 \cite{rfc6749}, and OpenID Connect \cite{oidc} protocols are by far the most popular protocols to choose for implementation. The engineers behind the eIDAS network implementation decided to settle on the SAML protocol.

% ##### Research methodology

% ###### Development complexity

% One of primary outcomes of the research is to measure the complexity of the development. A model [26] will be used to measure the complexity of the examples and documentation provided by the services, and assign that to measurable values, which can be compared.


% By having this access, this process is useful, as one service provider would be able to open up the entirety of the EU market. The main issue with using eIDAS nodes as an authentication method, is the restricted access to it. In email correspondence I learnt that in Estonia, access to this service is limited to public sector only, with plans to open it up to the private sector in 2022.

\subsection{Threats}

\TODO{There has to be a source with the extensive list, all protocols I checked look basically the same, but I can't seem to find a post saying yes, you need to do this.}

\begin{figure}
    \centering
    \begin{sequencediagram}
        \newthread{A}{Natural Person}{}
        \newinst[1]{B}{Relying Party}{}
        \newinst[1]{C}{QSCD Interface}{}
        \newinst[2]{D}{QSCD}{}

        \begin{call}{A}{authenticate()}{B}{Auth token}
            \begin{call}{B}{authenticate()}{C}{Certificate + authenticity proof}
                \begin{sdblock}{Block}{Outside of RP control}
                    \begin{call}{C}{getCertificate()}{D}{Client Authentication certificate}\end{call}
                    \begin{call}{C}{signChallenge()}{D}{Signed challenge}
                        \begin{call}{D}{enterPin()}{A}{PIN}\end{call}
                    \end{call}
                \end{sdblock}
            \end{call}
            \begin{call}{B}{validateResponse()}{B}{}\end{call}
        \end{call}

    \end{sequencediagram}
    \caption{High-level sequence diagram of a eID authentication flow}
    \label{fig:eid-auth-flow-seq}
\end{figure}

In the sequence diagram (see figure \ref{fig:eid-auth-flow-seq}), we see a high-level overview of any eID authentication solution. In the authentication protocol, the relying party (company implementing eID sign-in) is entirely dependent on the QSCD interface, which acts as a trust anchor. A communication channel exists between the relying party and the interface. We can categorize the channel type into two groups:

\begin{enumerate}
    \item trusted, where the sender can reasonably guarantee that adversaries are unable to change the data in transit (Smart-ID, TARA, Dokobit);
    \item untrusted, where there is a possibility for data to be tampered with in transit (Web eID).
\end{enumerate}

Trusted communications generally operate using an encrypted backchannel, where untrusted ones require the client to send data from the QSCD interface. Because the client sends the data, this becomes an untrusted channel, and the relying party must perform additional certificate verification.

Failure to encrypt and establish the authenticity of the interface in a trusted backchannel or not validating data in a untrusted channel allows adversaries to perform man-in-the-middle attacks.

\TODO{Limitations: For the scope of the thesis, only two security aspects will be analyzed: the network communication between the natural person and the interface and the certificate authenticity guarantees. Security analysis of QSCD and its communications with the interface will not be analyzed.}

\TODO{Further research? Limitations: proper analysis of what companies would like to see in a solution for easier bullet points}